#!/usr/bin/env php
<?php
include(__DIR__ . '/Flattener.php');

if (count($argv) === 1) {
    err("Missing mandatory source directory parameter", 2);
}
$src = realpath($argv[1]);
if (!$src) {
    err("The directory provided is not accessible", 3);
}

$showProgress = DIRECTORY_SEPARATOR !== '\\'; // no progress bar for windows
try {
    $fl = new helvete\Tools\Flattener($src, $showProgress);
    $fl->transmogrify();
    echo PHP_EOL;
} catch (Exception $e) {
    err($e->getMessage(), $e->getCode());
}

function err($msg = '', $exitCode = 127) {
    echo "ERROR: $msg" . PHP_EOL;
    exit($exitCode);
}
